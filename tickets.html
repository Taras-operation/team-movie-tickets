<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ö–≤–∏—Ç–æ–∫</title>
  <style>
    :root{--bg:#0b0f17;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--line:#1f2937;--ok:#22c55e;--warn:#f59e0b}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial}
    .wrap{max-width:720px;margin:0 auto;padding:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px}
    h1{margin:0 0 10px;font-size:20px}
    .muted{color:var(--muted)}
    .row{display:flex;justify-content:space-between;gap:10px;padding:8px 0;border-bottom:1px dashed #223047}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:700}
    .paid{background:rgba(34,197,94,.15);color:var(--ok);border:1px solid rgba(34,197,94,.35)}
    .entr{background:rgba(245,158,11,.15);color:var(--warn);border:1px solid rgba(245,158,11,.35)}
    .code{font-size:28px;font-weight:900;letter-spacing:1px;margin-top:8px}
    .btn{display:inline-block;margin-top:12px;background:#2563eb;color:#fff;padding:10px 12px;border-radius:10px;text-decoration:none}
    .err{color:#fca5a5}
    ul{margin:6px 0 0;padding-left:18px}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>üéü –ö–≤–∏—Ç–æ–∫ –Ω–∞ –∑–∞–∫—Ä–∏—Ç–∏–π –ø–æ–∫–∞–∑</h1>
    <div class="muted">–ü–æ–∫–∞–∂—ñ—Ç—å —Ü–µ–π –∫–≤–∏—Ç–æ–∫ –Ω–∞ –≤—Ö–æ–¥—ñ.</div>

    <div style="margin-top:12px" id="content">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è‚Ä¶</div>

    <a class="btn" href="index.html">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –≤–∏–±–æ—Ä—É –º—ñ—Å—Ü—å</a>
  </div>
</div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbxUdvb-OyoYtDk8kn2jV-wyA7jYDtiWdJlKlitHN_v-BkOmamLtWby82bUnKsU_5D8Mow/exec";

  function qs(name){
    const u = new URL(window.location.href);
    return u.searchParams.get(name);
  }

  function esc(s){
    return String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  async function loadTicket(){
    const orderId = qs('order_id');
    const el = document.getElementById('content');
    if (!orderId){
      el.innerHTML = `<div class="err">–ù–µ–º–∞—î order_id —É –ø–æ—Å–∏–ª–∞–Ω–Ω—ñ.</div>`;
      return;
    }

    const url = `${API_URL}?action=ticket&order_id=${encodeURIComponent(orderId)}`;
    const res = await fetch(url, { method:'GET' });
    const data = await res.json();

    if (!data.ok){
      if (data.error === 'expired') {
        el.innerHTML = `<div class="err">–ë—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–∏–ª–æ—Å—å (10 —Ö–≤ –º–∏–Ω—É–ª–æ). –°–ø—Ä–æ–±—É–π—Ç–µ –æ–±—Ä–∞—Ç–∏ –º—ñ—Å—Ü—è –∑–Ω–æ–≤—É.</div>`;
        return;
      }
      el.innerHTML = `<div class="err">–ü–æ–º–∏–ª–∫–∞: ${esc(data.error || 'unknown')}</div>`;
      return;
    }

    const t = data.ticket;
    const seats = String(t.seats||'').split(',').map(s=>s.trim()).filter(Boolean);

    let badge = '';
    if (t.status === 'paid') badge = `<span class="badge paid">‚úÖ –û–ø–ª–∞—á–µ–Ω–æ –æ–Ω–ª–∞–π–Ω</span>`;
    else if (t.status === 'entrance') badge = `<span class="badge entr">‚è≥ –û–ø–ª–∞—Ç–∞ –ø—Ä–∏ –≤—Ö–æ–¥—ñ</span>`;
    else if (t.status === 'reserved') badge = `<span class="badge entr">‚è≥ –ó–∞–±—Ä–æ–Ω—å–æ–≤–∞–Ω–æ (–æ—á—ñ–∫—É—î –æ–ø–ª–∞—Ç–∏)</span>`;
    else badge = `<span class="badge entr">–°—Ç–∞—Ç—É—Å: ${esc(t.status)}</span>`;

    el.innerHTML = `
      <div class="row"><div class="muted">–ü–æ–∫—É–ø–µ—Ü—å</div><div><b>${esc(t.name)}</b></div></div>
      <div class="row"><div class="muted">–¢–µ–ª–µ—Ñ–æ–Ω</div><div>${esc(t.phone)}</div></div>
      <div class="row"><div class="muted">–ú—ñ—Å—Ü—è</div><div>
        <ul>${seats.map(s=>{
          const [r,seat]=s.split('-');
          return `<li>–†—è–¥ ${esc(r)}, –º—ñ—Å—Ü–µ ${esc(seat)}</li>`;
        }).join('')}</ul>
      </div></div>
      <div style="margin-top:10px">${badge}</div>
      <div style="margin-top:10px" class="muted">–ö–æ–¥ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</div>
      <div class="code">${esc(t.order_id)}</div>
    `;
  }

  loadTicket();
</script>
</body>
</html>